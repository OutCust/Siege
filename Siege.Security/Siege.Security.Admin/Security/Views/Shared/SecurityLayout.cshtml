@using System.Web.Mvc
@using Siege.Security.Principals

@{
    var user = (SecurityPrincipal) HttpContext.Current.User;
    Layout = "~/Views/Shared/_Layout.cshtml";
    //@model Siege.Security.Admin.Security.Models.SecurityModel
    //var appList = Model.Applications;
    //var consumerList = Model.Consumers;
    //var apps = new SelectList(appList, "ID", "Name");
    //var consumers = new SelectList(consumerList, "ID", "Name");
}

@section head
{
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("/Security/styles/ui.jqgrid.css")" />
    <link rel="stylesheet" type="text/css" media="screen" href="@Url.Content("/Security/styles/SecurityAdmin.css")" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script src="@Url.Content("/Security/scripts/grid.locale-en.js")" type="text/javascript"></script>
    <script src="@Url.Content("/Security/scripts/jquery.jqGrid.min.js")" type="text/javascript"> </script>
    <script src="@Url.Content("/Security/scripts/jquery.statusMessageQ.js")" type="text/javascript"> </script>
}

<div id="security_section">
    <div id="security_menu">
        <div id="security_menu_header">Security
            <div id="security_menu_row"> - <a href="/Security/Users/Index">Users</a></div>
            <div id="security_menu_row"> - <a href="/Security/Groups/Index">Groups</a></div>
            <div id="security_menu_row"> - <a href="/Security/Roles/Index">Roles</a></div>
        </div>
    </div>    
    <div id="security_body">
        <div>
            <div id="consumerList">Select A Consumer:
                <select id="consumers" onselect="GetApplicationFor(0)"></select>
            </div>
            <div id="applicationList">Select An Application:
                <select id="applications"></select>
            </div>
            <div id="applicationSingle">
                <h3>Application: <span id="application"></span></h3>
            </div>
        </div>
        <input type="hidden" id="consumerID" />
        <input type="hidden" id="applicationID" />
        <br/>
        <hr/>
        
        @RenderBody()
    </div>
</div>

<script language="javascript" type="text/javascript">
    $(document).ready(function () {

        $("#consumerList").hide();
        $("#consumerSingle").hide();
        $("#applicationList").hide();
        $("#applicationSingle").hide();

        $.getJSON("/Security/Consumers/Get/", function (result) {
            var options = $("#consumers");
            if (result.total > 1) {
                $.each(result.rows, function () {
                    options.append($("<option />").val(this.id).text(this.Name));
                });

                $("#consumerList").show();
                $("#consumerID").text($("#consumers").val());
                GetApplicationFor(0);
            } else {

                options.append($("<option />").val(result.rows[0].id).text(result.rows[0].Name));

                $("#consumerID").text(result.rows[0].id);
                GetApplicationFor(result.rows[0].id);
            }
        });
    });

    function GetApplicationFor(id) {

        if (id == 0)
            id = $("#consumers").val();

        $.getJSON("/Security/Applications/GetForConsumer/"+id, function(result) {
            var options = $("#applications");
            if (result.total > 1) {
                $.each(result.rows, function() {
                    options.append($("<option />").val(this.id).text(this.Name));
                });

                $("#applicationList").show();
                $("#applicationID").text($("#applications").val());
            } else {

                options.append($("<option />").val(result.rows[0].id).text(result.rows[0].Name));

                $("#application").text(result.rows[0].Name);
                $("#applicationID").text(result.rows[0].id);
                $("#applicationSingle").show();
            }
        });

        Show();
    }
</script>